import{ab as T,k as v,t as C,v as f,w as L,x as z,a9 as l,j as e,aa as I,T as R,aT as A,a7 as O}from"./index-uqWBUhkX.js";import{r as m,u as U,f as D,L as g}from"./vendor-CST6t91B.js";const M=()=>{const[i,d]=m.useState(!1),t=U(),[N]=D(),{urlApi:j}=m.useContext(T),{saveSession:w,role:o,isAuthenticated:c}=v(),y=C({email:f().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),password:f().required("Veuillez entrer votre mot de passe")}),{control:k,handleSubmit:E}=L({resolver:z(y),defaultValues:{email:"",password:""}}),a=N.get("redirectTo")??"/admin/dashboard";console.log("redirectUrl",a),m.useEffect(()=>{c&&o&&o=="ROLE_ADMIN"&&a=="/admin/dashboard"&&t("/admin/dashboard"),c&&o&&o=="ROLE_DEMANDEUR"&&a=="/demandeur/dashboard"&&t("/demandeur/dashboard"),c&&o&&o=="ROLE_INSTITUT"&&a=="/institut/dashboard"&&t("/institut/dashboard")},[c,t,a]);const S=E(async u=>{var h,b,p,x;d(!0);try{const r=await fetch(j+"login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});console.log(JSON.stringify(u));const s=await r.json();if(console.log(s),s.code=="401"){l.error(s.message,{position:"top-right",duration:2e3});return}if(s.code=="403"){l.error(s.status,{position:"top-right",duration:2e3});return}if(!r.ok)throw new Error(`Erreur ${r.status}: ${r.statusText}`);if(console.log(s.user.roles),console.log(u),s.token){w({token:s.token,user:s.user,role:s.user.roles,institut:((h=s.user)==null?void 0:h.institut)??null,demandeur:((b=s.user)==null?void 0:b.demandeur)??null}),l.success("Connexion réussie. Redirection...",{position:"top-right",duration:2e3}),console.log("redirectUrl",a),console.log("role",o);let n=a;s.user.roles.includes("ROLE_INSTITUT")?(n="/institut/dashboard",t(n)):s.user.roles.includes("ROLE_DEMANDEUR")?(n="/demandeur/dashboard",t(n)):s.user.roles.includes("ROLE_ADMIN")&&(n="/admin/dashboard",t(n))}}catch(r){console.log(r),(x=(p=r.response)==null?void 0:p.data)!=null&&x.error?l.error(r.response.data.error,{position:"top-right",duration:2e3}):l.error("Une erreur s'est produite lors de la connexion.",{position:"top-right",duration:2e3})}finally{d(!1)}});return{loading:i,login:S,control:k}},P=()=>{const{loading:i,login:d,control:t}=M();return e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"Connexion"}),e.jsxs("form",{className:"mt-2 shrink",onSubmit:d,children:[e.jsx(R,{containerClassName:"mb-4",label:"Adresse email",name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:t}),e.jsx(A,{label:"Mot de passe",containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:t}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2",children:[e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"size-4 rounded border-white/20 bg-white/20 text-primary shadow-sm focus:border-primary focus:ring focus:ring-primary/60 focus:ring-offset-0",id:"checkbox-signin"}),e.jsx("label",{className:"ms-2 select-none align-middle text-base/none text-zinc-200",htmlFor:"checkbox-signin",children:"Se souvenir de moi"})]}),e.jsx(g,{to:"/auth/forgot-pass",className:"border-b border-dashed text-zinc-200",children:e.jsx("small",{children:"Mot de passe oublié ?"})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{type:"submit",disabled:i,className:"group mt-5 inline-flex w-full items-center justify-center rounded bg-blueLogo  px-6 py-2.5 text-white backdrop-blur-2xl transition-all  hover:text-white",children:[i?"Chargement...":"Se connecter",i&&e.jsx(O,{className:"animate-spin"})]})})]}),e.jsx("br",{}),e.jsxs("p",{className:"shrink text-center text-zinc-200",children:["Vous n'avez pas de compte ?",e.jsx(g,{to:"/registration?type=demandeur",className:"ms-1 text-primary",children:e.jsx("b",{children:"Inscription"})})]}),e.jsx("br",{})]})};export{P as default};
