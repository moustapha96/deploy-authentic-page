import{ab as T,k as L,v as S,w as f,x as v,y as C,a9 as d,u as R,j as e,aa as z,T as A,aT as O,a7 as U}from"./index-CkkIKajf.js";import{r as m,u as D,f as F,L as w}from"./vendor-CST6t91B.js";const M=()=>{const[o,c]=m.useState(!1),r=D(),[t]=F(),{urlApi:N}=m.useContext(T),{saveSession:j,role:n,isAuthenticated:u}=L(),y=S({email:f().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),password:f().required("Veuillez entrer votre mot de passe")}),{control:I,handleSubmit:k}=v({resolver:C(y),defaultValues:{email:"",password:""}}),l=t.get("redirectTo")??"/admin/dashboard";m.useEffect(()=>{u&&n&&n=="ROLE_ADMIN"&&l=="/admin/dashboard"&&r("/admin/dashboard"),u&&n&&n=="ROLE_DEMANDEUR"&&l=="/demandeur/dashboard"&&r("/demandeur/dashboard"),u&&n&&n=="ROLE_INSTITUT"&&l=="/institut/dashboard"&&r("/institut/dashboard")},[u,r,l]);const E=k(async b=>{var h,x,p,g;c(!0);try{const a=await fetch(N+"login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});console.log(JSON.stringify(b));const s=await a.json();if(s.code=="401"){d.error(s.message,{position:"top-right",duration:2e3});return}if(s.code=="403"){d.error(s.status,{position:"top-right",duration:2e3});return}if(!a.ok)throw new Error(`Erreur ${a.status}: ${a.statusText}`);if(s.token){j({token:s.token,user:s.user,role:s.user.roles,institut:((h=s.user)==null?void 0:h.institut)??null,demandeur:((x=s.user)==null?void 0:x.demandeur)??null}),d.success("Connexion rÃ©ussie. Redirection...",{position:"top-right",duration:2e3});let i=l;s.user.roles.includes("ROLE_INSTITUT")?(i="/institut/dashboard",r(i)):s.user.roles.includes("ROLE_DEMANDEUR")?(i="/demandeur/dashboard",r(i)):s.user.roles.includes("ROLE_ADMIN")&&(i="/admin/dashboard",r(i))}}catch(a){(g=(p=a.response)==null?void 0:p.data)!=null&&g.error?d.error(a.response.data.error,{position:"top-right",duration:2e3}):d.error("Une erreur s'est produite lors de la connexion.",{position:"top-right",duration:2e3})}finally{c(!1)}});return{loading:o,login:E,control:I}},V=()=>{const{loading:o,login:c,control:r}=M(),{t}=R();return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:t("signIn.title")}),e.jsxs("form",{className:"mt-2 shrink",onSubmit:c,children:[e.jsx(A,{containerClassName:"mb-4",label:t("signIn.emailLabel"),name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:r}),e.jsx(O,{label:t("signIn.passwordLabel"),containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:r}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2",children:[e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"size-4 rounded border-white/20 bg-white/20 text-primary shadow-sm focus:border-primary focus:ring focus:ring-primary/60 focus:ring-offset-0",id:"checkbox-signin"}),e.jsx("label",{className:"ms-2 select-none align-middle text-base/none text-zinc-200",htmlFor:"checkbox-signin",children:t("signIn.rememberMe")})]}),e.jsx(w,{to:"/auth/forgot-pass",className:"border-b border-dashed text-zinc-200",children:e.jsx("small",{children:t("signIn.forgotPassword")})})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{type:"submit",disabled:o,className:"group mt-5 inline-flex w-full items-center justify-center rounded bg-blueLogo  px-6 py-2.5 text-white backdrop-blur-2xl transition-all  hover:text-white",children:[t(o?"signIn.loading":"signIn.signInButton"),o&&e.jsx(U,{className:"animate-spin"})]})})]}),e.jsx("br",{}),e.jsxs("p",{className:"shrink text-center text-zinc-200",children:[t("signIn.noAccount"),e.jsx(w,{to:"/registration?type=demandeur",className:"ms-1 text-primary",children:e.jsx("b",{children:t("signIn.signUp")})})]}),e.jsx("br",{})]})};export{V as default};
