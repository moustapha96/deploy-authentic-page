import{a3 as k,u as S,w as C,x,y as v,z,a6 as i,j as e,a2 as T,bM as E}from"./index-LViY93sK.js";import{T as L}from"./TextFormInput-g3KM2f_R.js";import{r as b,e as F,i as U,L as A}from"./vendor-CRMiJ7ZJ.js";const I=()=>{const[o,n]=b.useState(!1),r=F(),[p]=U(),{urlApi:h}=b.useContext(k),{saveSession:g,role:f}=S(),w=C({email:x().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),password:x().required("Veuillez entrer votre mot de passe")}),{control:j,handleSubmit:y}=v({resolver:z(w),defaultValues:{email:"",password:""}}),l=p.get("redirectTo")??"/admin/dashboard",N=y(async a=>{var c,d,u,m;n(!0);try{const t=await fetch(h+"login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});console.log(JSON.stringify(a));const s=await t.json();if(!t.ok)throw new Error(`Erreur ${t.status}: ${t.statusText}`);console.log(s.user.roles),console.log(a),s.token&&(g({token:s.token,user:s.user,role:s.user.roles,institut:((c=s.user)==null?void 0:c.institut)??null,demandeur:((d=s.user)==null?void 0:d.demandeur)??null}),i.success("Connexion réussie. Redirection...",{position:"top-right",duration:2e3}),console.log("redirectUrl",l),console.log("role",f),s.user.roles.includes("ROLE_INSTITUT")?r("/institut/dashboard"):s.user.roles.includes("ROLE_DEMANDEUR")?r("/demandeur/dashboard"):r(l))}catch(t){console.log(t),(m=(u=t.response)==null?void 0:u.data)!=null&&m.error?i.error(t.response.data.error,{position:"top-right",duration:2e3}):i.error("Une erreur s'est produite lors de la connexion.",{position:"top-right",duration:2e3})}finally{n(!1)}});return{loading:o,login:N,control:j}},R=()=>{const{loading:o,login:n,control:r}=I();return e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Connexion"}),e.jsxs("form",{className:"mt-2 shrink",onSubmit:n,children:[e.jsx(L,{containerClassName:"mb-4",label:"Adresse email",name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:r}),e.jsx(E,{label:"Mot de passe",containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:r}),e.jsxs("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2",children:[e.jsxs("div",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"size-4 rounded border-white/20 bg-white/20 text-primary shadow-sm focus:border-primary focus:ring focus:ring-primary/60 focus:ring-offset-0",id:"checkbox-signin"}),e.jsx("label",{className:"ms-2 select-none align-middle text-base/none text-zinc-200",htmlFor:"checkbox-signin",children:"Se souvenir de moi"})]}),e.jsx(A,{to:"/auth/forgot-pass",className:"border-b border-dashed text-zinc-200",children:e.jsx("small",{children:"Mot de passe oublié ?"})})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",disabled:o,className:"group mt-5 inline-flex w-full items-center justify-center rounded bg-blueLogo  px-6 py-2.5 text-white backdrop-blur-2xl transition-all  hover:text-white",children:o?"Chargement...":"Se connecter"})})]}),e.jsx("br",{})]})};export{R as default};
